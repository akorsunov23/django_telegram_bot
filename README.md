# Телеграм-бот + Джанго админ-панель


## Как установить
Для работы бота нужен Python версии не ниже 3.10.    
Создайте в IDE новый пустой проект, и в консоли IDE выполняйте следующие шаги:

- Склонировать репозиторий
```shell
git clone https://github.com/akorsunov23/django_telegram_bot
```
- Перейти в папку проекта
```shell
cd django_telegram_bot
```
- Переименуйте файл .env.template в .env
- Заполните .env файл. Пример:  
```yaml
BOT_TOKEN = 'токен полученный от @BotFather'
```
- Установка виртуального окружения для среды разработки на примере ОС Windows
```shell
python -m venv venv
```
- Перейти в директорию виртуального окружения
```shell
cd venv\Scripts\
```
- Активировать виртуальное окружение
```shell
activate
```
- Перейти в папку проекта
```shell
cd ..\..
```
- Установить все зависимости
```shell
pip install -r requirements.txt
```
- Установка виртуального окружения для продовой среды на примере ОС Linux
```shell
python -m venv venv
. venv/bin/activate
pip install -r requirements.txt
```
## Как запустить web-сервер и телеграм бота

Все команды выполняемые через `manage.py` производится в активированном виртуальном окружение из папки `django_telegram_bot/`

- Выполнить миграцию базы данных
```shell
python manage.py migrate
```
- Добавить администратора админ-панели Джанго
```shell
python manage.py createsuperuser
```
- Загрузить фикстуру с стандартными сообщениями
````shell
python manage.py loaddata message.json
````
Команды для запуска сервера и бота проводятся в разных терминалах, и при открытии нового окна терминала не забываем активировать виртуальное окружение.
- Запуск сервера
```shell
python manage.py runserver
```
- Запуск бота
```shell
python manage.py runbot
```

Админ-панель будет доступна по адресу `http://127.0.0.1:8000/admin/`, телеграм-бот по заданному имени у @BotFather


## Админ-панель Джанго

- Зарегистрированные пользователи. 
Информация о зарегистрированном пользователе, а также статистика по нажатиям кнопок.
- Первая категория кнопок. 
Здесь есть возможность добавлять, редактировать и удалять кнопки первой категории. 
Описание кнопки - то, что приходит после нажатия на неё 
(поддерживает HTML теги форматирования текста, смайлики).
- Вторая категория кнопок. 
Здесь есть возможность добавлять, редактировать и удалять кнопки второй категории. 
Обязательно наследуются от кнопки первой категории. 
Описание кнопки - то, что приходит после нажатия на неё 
(поддерживает HTML теги форматирования текста, смайлики).
- Третья категория кнопок. 
Здесь есть возможность добавлять, редактировать и удалять кнопки третьей категории. 
Обязательно наследуются от кнопки второй категории. 
У данной категории есть возможность добавлять несколько разных сообщений с изображениями.
Описание сообщения - то, что приходит после нажатия на неё (поддерживает HTML теги форматирования текста, смайлики).

- Администраторы. Есть возможность добавлять ID телеграмма пользователя, 
после чего ему приходят уведомления о новом зарегистрированном пользователе.
- Приветственное сообщение. 
Сообщение, приходит пользователю после завершения регистрации. Можно только редактировать.
- Сообщение о рандомном вводе. 
Сообщение, приходит пользователю, если тот отправляет любые текстовые сообщения в режиме кнопок. Можно только редактировать.

**Важно!!!**

- При добавлении сообщений к третьей категории кнопок есть методы фильтрации:
1. установлены даты отправки и не установлены флаги "пожизненно" или "сезон" - 
сообщение будет отправляться в установленный срок, и удалено по его истечению;
2. установлены даты отправки и установлен флаг "сезон" - 
сообщение будет отправляться в установленный срок, ежегодно;
3. установлены даты отправки и установлен флаг "пожизненно" - 
сообщение будет отправляться игнорируя даты.

- Все описания кнопок, приветственное и об неверном вводе сообщения поддерживают HTML код, и смайлики на HTML коде. 
Дополнительное подсказки есть в админ-панели к описанию поля.
- Кнопки не поддерживают форматирование текста, но есть возможность добавления к ним эмодзи в ЮНИКОДЕ.
Для этого необходимо отредактировать код в `tg_bot/bot/keyboards/category.py`, строка 12, 30, 31, 45, 46.

